{"version":3,"file":"index.esm.js","sources":["../src/index.ts"],"sourcesContent":["import { io, Socket } from 'socket.io-client';\nimport './styles.css';\n\ninterface WidgetConfig {\n  apiKey: string | null;\n  organization: string | null;\n  userId: string | null;\n  userName: string | null;\n  userEmail: string | null;\n  apiUrl: string;\n  socketUrl: string;\n  position: 'right' | 'left';\n  primaryColor: string;\n  headerText: string;\n  placeholder: string;\n  welcomeMessage: string | null;\n  autoOpen: boolean;\n  debug: boolean;\n}\n\ninterface Message {\n  content: string;\n  sender: {\n    _id: string;\n    firstName?: string;\n    lastName?: string;\n    avatar?: string;\n  };\n  createdAt: Date;\n}\n\nclass SaaSChatWidget {\n  private config: WidgetConfig;\n  private socket: Socket | null = null;\n  private currentChatId: string | null = null;\n  private pendingMessages: string[] = [];\n  private elements: {\n    widgetContainer: HTMLElement | null;\n    chatButton: HTMLElement | null;\n    chatWindow: HTMLElement | null;\n    messagesContainer: HTMLElement | null;\n    input: HTMLTextAreaElement | null;\n    sendButton: HTMLElement | null;\n  } = {\n    widgetContainer: null,\n    chatButton: null,\n    chatWindow: null,\n    messagesContainer: null,\n    input: null,\n    sendButton: null,\n  };\n\n  constructor(config: Partial<WidgetConfig> = {}) {\n\n    this.config = {\n      apiKey: null,\n      organization: null,\n      userId: null,\n      userName: null,\n      userEmail: null,\n      apiUrl: 'https://api.saas-chat.com',\n      socketUrl: 'https://api.saas-chat.com',\n      position: 'right',\n      primaryColor: '#6366f1',\n      headerText: 'Chat Support',\n      placeholder: 'Type a message...',\n      welcomeMessage: 'Hello! How can we help you today?',\n      autoOpen: false,\n      debug: false,\n      ...config,\n    };\n\n\n    this.init();\n  }\n\n\n  private init(): void {\n    this.log('Initializing widget');\n    this.createStyles();\n    this.createWidgetElements();\n\n\n    if (this.config.autoOpen) {\n      setTimeout(() => {\n        this.openChatWindow();\n      }, 1000);\n    }\n  }\n\n\n  private createStyles(): void {\n    const style = document.createElement('style');\n    style.textContent = `\n      .saas-chat-widget {\n        position: fixed;\n        bottom: 20px;\n        ${this.config.position === 'right' ? 'right: 20px' : 'left: 20px'};\n        z-index: 9999;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\n      }\n\n      .saas-chat-button {\n        width: 60px;\n        height: 60px;\n        border-radius: 50%;\n        background-color: ${this.config.primaryColor};\n        color: white;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        cursor: pointer;\n        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n        transition: all 0.2s ease;\n      }\n\n      .saas-chat-button:hover {\n        transform: scale(1.05);\n        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);\n      }\n\n      .saas-chat-button svg {\n        width: 28px;\n        height: 28px;\n      }\n\n      .saas-chat-window {\n        position: fixed;\n        bottom: 90px;\n        ${this.config.position === 'right' ? 'right: 20px' : 'left: 20px'};\n        width: 360px;\n        height: 500px;\n        background-color: white;\n        border-radius: 12px;\n        box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2);\n        display: flex;\n        flex-direction: column;\n        overflow: hidden;\n        transition: all 0.3s ease;\n        opacity: 0;\n        transform: translateY(20px) scale(0.95);\n        pointer-events: none;\n      }\n\n      .saas-chat-window.open {\n        opacity: 1;\n        transform: translateY(0) scale(1);\n        pointer-events: all;\n      }\n\n      .saas-chat-header {\n        background-color: ${this.config.primaryColor};\n        color: white;\n        padding: 15px 20px;\n        font-weight: 600;\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n      }\n\n      .saas-chat-close {\n        cursor: pointer;\n        opacity: 0.8;\n        transition: opacity 0.2s;\n      }\n\n      .saas-chat-close:hover {\n        opacity: 1;\n      }\n\n      .saas-chat-messages {\n        flex: 1;\n        overflow-y: auto;\n        padding: 15px;\n        background-color: #f5f7fb;\n      }\n\n      .saas-chat-message {\n        margin-bottom: 10px;\n        max-width: 80%;\n        padding: 10px 15px;\n        border-radius: 18px;\n        position: relative;\n        word-wrap: break-word;\n      }\n\n      .saas-chat-message.user {\n        background-color: ${this.config.primaryColor};\n        color: white;\n        margin-left: auto;\n        border-bottom-right-radius: 4px;\n      }\n\n      .saas-chat-message.agent {\n        background-color: #e5e7eb;\n        color: #1f2937;\n        margin-right: auto;\n        border-bottom-left-radius: 4px;\n      }\n\n      .saas-chat-input-container {\n        padding: 10px 15px;\n        border-top: 1px solid #e5e7eb;\n        display: flex;\n        align-items: center;\n      }\n\n      .saas-chat-input {\n        flex: 1;\n        border: 1px solid #d1d5db;\n        border-radius: 20px;\n        padding: 8px 15px;\n        outline: none;\n        font-size: 14px;\n        resize: none;\n        max-height: 100px;\n        overflow-y: auto;\n      }\n\n      .saas-chat-input:focus {\n        border-color: ${this.config.primaryColor};\n        box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2);\n      }\n\n      .saas-chat-send {\n        margin-left: 10px;\n        width: 36px;\n        height: 36px;\n        border-radius: 50%;\n        background-color: ${this.config.primaryColor};\n        color: white;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        cursor: pointer;\n        border: none;\n        outline: none;\n      }\n\n      .saas-chat-send:disabled {\n        background-color: #d1d5db;\n        cursor: not-allowed;\n      }\n\n      .saas-chat-send svg {\n        width: 18px;\n        height: 18px;\n      }\n\n      @media (max-width: 480px) {\n        .saas-chat-window {\n          width: calc(100% - 40px);\n          height: calc(100% - 120px);\n          bottom: 80px;\n        }\n      }\n    `;\n    document.head.appendChild(style);\n  }\n\n\n  private createWidgetElements(): void {\n\n    const widgetContainer = document.createElement('div');\n    widgetContainer.className = 'saas-chat-widget';\n\n\n    const chatButton = document.createElement('div');\n    chatButton.className = 'saas-chat-button';\n    chatButton.innerHTML = '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z\"></path></svg>';\n    chatButton.addEventListener('click', this.toggleChatWindow.bind(this));\n\n\n    const chatWindow = document.createElement('div');\n    chatWindow.className = 'saas-chat-window';\n    chatWindow.id = 'saas-chat-window';\n\n\n    const chatHeader = document.createElement('div');\n    chatHeader.className = 'saas-chat-header';\n    chatHeader.innerHTML = `\n      <div>${this.config.headerText}</div>\n      <div class=\"saas-chat-close\">\n        <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n          <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"></line>\n          <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"></line>\n        </svg>\n      </div>\n    `;\n    chatHeader.querySelector('.saas-chat-close')?.addEventListener('click', this.closeChatWindow.bind(this));\n\n\n    const messagesContainer = document.createElement('div');\n    messagesContainer.className = 'saas-chat-messages';\n    messagesContainer.id = 'saas-chat-messages';\n\n\n    const inputContainer = document.createElement('div');\n    inputContainer.className = 'saas-chat-input-container';\n\n\n    const input = document.createElement('textarea');\n    input.className = 'saas-chat-input';\n    input.placeholder = this.config.placeholder;\n    input.rows = 1;\n    input.addEventListener('keydown', (e) => {\n      if (e.key === 'Enter' && !e.shiftKey) {\n        e.preventDefault();\n        this.sendMessage();\n      }\n\n\n      setTimeout(() => {\n        input.style.height = 'auto';\n        input.style.height = Math.min(input.scrollHeight, 100) + 'px';\n      }, 0);\n    });\n\n\n    const sendButton = document.createElement('button');\n    sendButton.className = 'saas-chat-send';\n    sendButton.innerHTML = '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><line x1=\"22\" y1=\"2\" x2=\"11\" y2=\"13\"></line><polygon points=\"22 2 15 22 11 13 2 9 22 2\"></polygon></svg>';\n    sendButton.addEventListener('click', this.sendMessage.bind(this));\n\n\n    inputContainer.appendChild(input);\n    inputContainer.appendChild(sendButton);\n\n    chatWindow.appendChild(chatHeader);\n    chatWindow.appendChild(messagesContainer);\n    chatWindow.appendChild(inputContainer);\n\n    widgetContainer.appendChild(chatWindow);\n    widgetContainer.appendChild(chatButton);\n\n    document.body.appendChild(widgetContainer);\n\n\n    this.elements = {\n      widgetContainer,\n      chatButton,\n      chatWindow,\n      messagesContainer,\n      input,\n      sendButton,\n    };\n\n\n    if (this.config.welcomeMessage) {\n      this.addMessage(this.config.welcomeMessage, 'agent');\n    }\n  }\n\n\n  private toggleChatWindow(): void {\n    if (this.elements.chatWindow?.classList.contains('open')) {\n      this.closeChatWindow();\n    } else {\n      this.openChatWindow();\n    }\n  }\n\n\n  private openChatWindow(): void {\n    this.elements.chatWindow?.classList.add('open');\n    this.elements.input?.focus();\n\n\n    this.initializeSocket();\n  }\n\n\n  private closeChatWindow(): void {\n    this.elements.chatWindow?.classList.remove('open');\n  }\n\n\n  private addMessage(content: string, type: 'user' | 'agent'): void {\n    if (!this.elements.messagesContainer) return;\n\n    const messageElement = document.createElement('div');\n    messageElement.className = `saas-chat-message ${type}`;\n    messageElement.textContent = content;\n    this.elements.messagesContainer.appendChild(messageElement);\n\n\n    this.elements.messagesContainer.scrollTop = this.elements.messagesContainer.scrollHeight;\n  }\n\n\n  private sendMessage(): void {\n    if (!this.elements.input) return;\n\n    const message = this.elements.input.value.trim();\n\n    if (!message) return;\n\n\n    this.addMessage(message, 'user');\n\n\n    this.elements.input.value = '';\n    this.elements.input.style.height = 'auto';\n\n\n    if (this.socket && this.socket.connected) {\n      this.socket.emit('send-message', {\n        chatId: this.currentChatId,\n        content: message,\n      });\n      this.log('Message sent:', message);\n    } else {\n      this.log('Socket not connected, storing message for later');\n      this.pendingMessages.push(message);\n\n\n      this.initializeSocket();\n    }\n  }\n\n\n  private initializeSocket(): void {\n    if (this.socket && this.socket.connected) {\n      this.log('Socket already connected');\n      return;\n    }\n\n    this.log('Connecting to socket server:', this.config.socketUrl);\n\n\n    if (!this.config.userId) {\n      this.config.userId = localStorage.getItem('saas-chat-user-id');\n      if (!this.config.userId) {\n        this.config.userId = 'widget_' + Math.random().toString(36).substring(2, 15);\n        localStorage.setItem('saas-chat-user-id', this.config.userId);\n      }\n    }\n\n\n    this.socket = io(this.config.socketUrl, {\n      auth: {\n        token: this.config.apiKey,\n        userId: this.config.userId,\n        userName: this.config.userName || 'Website Visitor',\n        userEmail: this.config.userEmail,\n        organization: this.config.organization,\n      },\n      transports: ['websocket'],\n    });\n\n\n    this.socket.on('connect', () => {\n      this.log('Socket connected');\n\n\n      this.getOrCreateChat();\n    });\n\n    this.socket.on('disconnect', () => {\n      this.log('Socket disconnected');\n    });\n\n    this.socket.on('error', (error) => {\n      this.log('Socket error:', error);\n    });\n\n    this.socket.on('new-message', (data) => {\n      this.log('New message received:', data);\n\n\n      if (data.message.sender._id !== this.config.userId) {\n        this.addMessage(data.message.content, 'agent');\n      }\n    });\n  }\n\n\n  private getOrCreateChat(): void {\n    this.log('Getting or creating chat');\n\n\n    this.currentChatId = localStorage.getItem('saas-chat-chat-id');\n\n    if (this.currentChatId) {\n      this.log('Found existing chat:', this.currentChatId);\n\n\n      if (this.socket) {\n        this.socket.emit('join-chat', this.currentChatId);\n      }\n\n\n      this.sendPendingMessages();\n    } else {\n      this.log('Creating new chat');\n\n\n      fetch(`${this.config.apiUrl}/api/widget/chats`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${this.config.apiKey}`,\n        },\n        body: JSON.stringify({\n          userId: this.config.userId,\n          userName: this.config.userName || 'Website Visitor',\n          userEmail: this.config.userEmail,\n          organization: this.config.organization,\n        }),\n      })\n      .then(response => response.json())\n      .then(data => {\n        this.log('Chat created:', data);\n\n        if (data.success && data.data && data.data._id) {\n          this.currentChatId = data.data._id;\n\n\n          localStorage.setItem('saas-chat-chat-id', this.currentChatId as string);\n\n\n          if (this.socket) {\n            this.socket.emit('join-chat', this.currentChatId);\n          }\n\n\n          this.sendPendingMessages();\n        } else {\n          this.log('Failed to create chat:', data);\n        }\n      })\n      .catch(error => {\n        this.log('Error creating chat:', error);\n      });\n    }\n  }\n\n\n  private sendPendingMessages(): void {\n    if (this.pendingMessages.length > 0 && this.currentChatId && this.socket) {\n      this.log('Sending pending messages:', this.pendingMessages);\n\n      this.pendingMessages.forEach(message => {\n        this.socket?.emit('send-message', {\n          chatId: this.currentChatId,\n          content: message,\n        });\n      });\n\n      this.pendingMessages = [];\n    }\n  }\n\n\n  private log(...args: any[]): void {\n    if (this.config.debug) {\n      console.log('SaaS Chat Widget:', ...args);\n    }\n  }\n\n\n  public open(): void {\n    this.openChatWindow();\n  }\n\n\n  public close(): void {\n    this.closeChatWindow();\n  }\n\n\n  public destroy(): void {\n\n    if (this.socket) {\n      this.socket.disconnect();\n      this.socket = null;\n    }\n\n\n    if (this.elements.widgetContainer) {\n      document.body.removeChild(this.elements.widgetContainer);\n    }\n\n\n    this.elements = {\n      widgetContainer: null,\n      chatButton: null,\n      chatWindow: null,\n      messagesContainer: null,\n      input: null,\n      sendButton: null,\n    };\n  }\n}\n\n\nif (typeof window !== 'undefined') {\n\n  const scriptElement = document.currentScript as HTMLScriptElement;\n\n  if (scriptElement) {\n    const config: Partial<WidgetConfig> = {};\n\n\n    Array.from(scriptElement.attributes).forEach(attr => {\n      if (attr.name.startsWith('data-')) {\n\n        const key = attr.name.slice(5).replace(/-([a-z])/g, (_, letter) => letter.toUpperCase()) as keyof WidgetConfig;\n\n\n        if (attr.value === 'true') {\n          (config as any)[key] = true;\n        } else if (attr.value === 'false') {\n          (config as any)[key] = false;\n        } else {\n          (config as any)[key] = attr.value;\n        }\n      }\n    });\n\n\n    (window as any).saasChat = new SaaSChatWidget(config);\n  }\n}\n\nexport default SaaSChatWidget;\n"],"names":["SaaSChatWidget","socket","currentChatId","pendingMessages","elements","widgetContainer","chatButton","chatWindow","messagesContainer","input","sendButton","constructor","config","apiKey","organization","userId","userName","userEmail","apiUrl","socketUrl","position","primaryColor","headerText","placeholder","welcomeMessage","autoOpen","debug","init","log","createStyles","createWidgetElements","setTimeout","openChatWindow","style","document","createElement","textContent","head","appendChild","className","innerHTML","addEventListener","toggleChatWindow","bind","id","chatHeader","querySelector","closeChatWindow","inputContainer","rows","e","key","shiftKey","preventDefault","sendMessage","height","Math","min","scrollHeight","body","addMessage","classList","contains","add","focus","initializeSocket","remove","content","type","messageElement","scrollTop","message","value","trim","connected","emit","chatId","push","localStorage","getItem","random","toString","substring","setItem","io","auth","token","transports","on","getOrCreateChat","error","data","sender","_id","sendPendingMessages","fetch","method","headers","JSON","stringify","then","response","json","success","catch","length","forEach","args","console","open","close","destroy","disconnect","removeChild","window","scriptElement","currentScript","Array","from","attributes","attr","name","startsWith","slice","replace","_","letter","toUpperCase","saasChat"],"mappings":";;AA+BA,MAAMA,cAAc,CAAC;AAEXC,EAAAA,MAAM,GAAkB,IAAI;AAC5BC,EAAAA,aAAa,GAAkB,IAAI;AACnCC,EAAAA,eAAe,GAAa,EAAE;AAC9BC,EAAAA,QAAQ,GAOZ;AACFC,IAAAA,eAAe,EAAE,IAAI;AACrBC,IAAAA,UAAU,EAAE,IAAI;AAChBC,IAAAA,UAAU,EAAE,IAAI;AAChBC,IAAAA,iBAAiB,EAAE,IAAI;AACvBC,IAAAA,KAAK,EAAE,IAAI;AACXC,IAAAA,UAAU,EAAE;GACb;AAEDC,EAAAA,WAAWA,CAACC,MAA6B,GAAG,EAAE,EAAE;IAE9C,IAAI,CAACA,MAAM,GAAG;AACZC,MAAAA,MAAM,EAAE,IAAI;AACZC,MAAAA,YAAY,EAAE,IAAI;AAClBC,MAAAA,MAAM,EAAE,IAAI;AACZC,MAAAA,QAAQ,EAAE,IAAI;AACdC,MAAAA,SAAS,EAAE,IAAI;AACfC,MAAAA,MAAM,EAAE,2BAA2B;AACnCC,MAAAA,SAAS,EAAE,2BAA2B;AACtCC,MAAAA,QAAQ,EAAE,OAAO;AACjBC,MAAAA,YAAY,EAAE,SAAS;AACvBC,MAAAA,UAAU,EAAE,cAAc;AAC1BC,MAAAA,WAAW,EAAE,mBAAmB;AAChCC,MAAAA,cAAc,EAAE,mCAAmC;AACnDC,MAAAA,QAAQ,EAAE,KAAK;AACfC,MAAAA,KAAK,EAAE,KAAK;MACZ,GAAGd;KACJ;IAGD,IAAI,CAACe,IAAI,EAAE;AACb;AAGQA,EAAAA,IAAIA,GAAS;AACnB,IAAA,IAAI,CAACC,GAAG,CAAC,qBAAqB,CAAC;IAC/B,IAAI,CAACC,YAAY,EAAE;IACnB,IAAI,CAACC,oBAAoB,EAAE;AAG3B,IAAA,IAAI,IAAI,CAAClB,MAAM,CAACa,QAAQ,EAAE;AACxBM,MAAAA,UAAU,CAAC,MAAM;QACf,IAAI,CAACC,cAAc,EAAE;OACtB,EAAE,IAAI,CAAC;AACV;AACF;AAGQH,EAAAA,YAAYA,GAAS;AAC3B,IAAA,MAAMI,KAAK,GAAGC,QAAQ,CAACC,aAAa,CAAC,OAAO,CAAC;IAC7CF,KAAK,CAACG,WAAW,GAAG;AACxB;AACA;AACA;AACA,QAAU,EAAA,IAAI,CAACxB,MAAM,CAACQ,QAAQ,KAAK,OAAO,GAAG,aAAa,GAAG,YAAY,CAAA;AACzE;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,0BAAA,EAA4B,IAAI,CAACR,MAAM,CAACS,YAAY,CAAA;AACpD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,QAAU,EAAA,IAAI,CAACT,MAAM,CAACQ,QAAQ,KAAK,OAAO,GAAG,aAAa,GAAG,YAAY,CAAA;AACzE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,0BAAA,EAA4B,IAAI,CAACR,MAAM,CAACS,YAAY,CAAA;AACpD;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,0BAAA,EAA4B,IAAI,CAACT,MAAM,CAACS,YAAY,CAAA;AACpD;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,sBAAA,EAAwB,IAAI,CAACT,MAAM,CAACS,YAAY,CAAA;AAChD;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,0BAAA,EAA4B,IAAI,CAACT,MAAM,CAACS,YAAY,CAAA;AACpD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAK,CAAA;AACDa,IAAAA,QAAQ,CAACG,IAAI,CAACC,WAAW,CAACL,KAAK,CAAC;AAClC;AAGQH,EAAAA,oBAAoBA,GAAS;AAEnC,IAAA,M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"}