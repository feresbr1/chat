!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("socket.io-client")):"function"==typeof define&&define.amd?define(["socket.io-client"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).SaaSChatWidget=t(e.io)}(this,(function(e){"use strict";var t;void 0===(t={insertAt:"top"})&&(t={}),t.insertAt;class n{socket=null;currentChatId=null;pendingMessages=[];elements={widgetContainer:null,chatButton:null,chatWindow:null,messagesContainer:null,input:null,sendButton:null};constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.config={apiKey:null,organization:null,userId:null,userName:null,userEmail:null,apiUrl:"https://api.saas-chat.com",socketUrl:"https://api.saas-chat.com",position:"right",primaryColor:"#6366f1",headerText:"Chat Support",placeholder:"Type a message...",welcomeMessage:"Hello! How can we help you today?",autoOpen:!1,debug:!1,...e},this.init()}init(){this.log("Initializing widget"),this.createStyles(),this.createWidgetElements(),this.config.autoOpen&&setTimeout((()=>{this.openChatWindow()}),1e3)}createStyles(){const e=document.createElement("style");e.textContent=`\n      .saas-chat-widget {\n        position: fixed;\n        bottom: 20px;\n        ${"right"===this.config.position?"right: 20px":"left: 20px"};\n        z-index: 9999;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\n      }\n\n      .saas-chat-button {\n        width: 60px;\n        height: 60px;\n        border-radius: 50%;\n        background-color: ${this.config.primaryColor};\n        color: white;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        cursor: pointer;\n        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n        transition: all 0.2s ease;\n      }\n\n      .saas-chat-button:hover {\n        transform: scale(1.05);\n        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);\n      }\n\n      .saas-chat-button svg {\n        width: 28px;\n        height: 28px;\n      }\n\n      .saas-chat-window {\n        position: fixed;\n        bottom: 90px;\n        ${"right"===this.config.position?"right: 20px":"left: 20px"};\n        width: 360px;\n        height: 500px;\n        background-color: white;\n        border-radius: 12px;\n        box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2);\n        display: flex;\n        flex-direction: column;\n        overflow: hidden;\n        transition: all 0.3s ease;\n        opacity: 0;\n        transform: translateY(20px) scale(0.95);\n        pointer-events: none;\n      }\n\n      .saas-chat-window.open {\n        opacity: 1;\n        transform: translateY(0) scale(1);\n        pointer-events: all;\n      }\n\n      .saas-chat-header {\n        background-color: ${this.config.primaryColor};\n        color: white;\n        padding: 15px 20px;\n        font-weight: 600;\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n      }\n\n      .saas-chat-close {\n        cursor: pointer;\n        opacity: 0.8;\n        transition: opacity 0.2s;\n      }\n\n      .saas-chat-close:hover {\n        opacity: 1;\n      }\n\n      .saas-chat-messages {\n        flex: 1;\n        overflow-y: auto;\n        padding: 15px;\n        background-color: #f5f7fb;\n      }\n\n      .saas-chat-message {\n        margin-bottom: 10px;\n        max-width: 80%;\n        padding: 10px 15px;\n        border-radius: 18px;\n        position: relative;\n        word-wrap: break-word;\n      }\n\n      .saas-chat-message.user {\n        background-color: ${this.config.primaryColor};\n        color: white;\n        margin-left: auto;\n        border-bottom-right-radius: 4px;\n      }\n\n      .saas-chat-message.agent {\n        background-color: #e5e7eb;\n        color: #1f2937;\n        margin-right: auto;\n        border-bottom-left-radius: 4px;\n      }\n\n      .saas-chat-input-container {\n        padding: 10px 15px;\n        border-top: 1px solid #e5e7eb;\n        display: flex;\n        align-items: center;\n      }\n\n      .saas-chat-input {\n        flex: 1;\n        border: 1px solid #d1d5db;\n        border-radius: 20px;\n        padding: 8px 15px;\n        outline: none;\n        font-size: 14px;\n        resize: none;\n        max-height: 100px;\n        overflow-y: auto;\n      }\n\n      .saas-chat-input:focus {\n        border-color: ${this.config.primaryColor};\n        box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2);\n      }\n\n      .saas-chat-send {\n        margin-left: 10px;\n        width: 36px;\n        height: 36px;\n        border-radius: 50%;\n        background-color: ${this.config.primaryColor};\n        color: white;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        cursor: pointer;\n        border: none;\n        outline: none;\n      }\n\n      .saas-chat-send:disabled {\n        background-color: #d1d5db;\n        cursor: not-allowed;\n      }\n\n      .saas-chat-send svg {\n        width: 18px;\n        height: 18px;\n      }\n\n      @media (max-width: 480px) {\n        .saas-chat-window {\n          width: calc(100% - 40px);\n          height: calc(100% - 120px);\n          bottom: 80px;\n        }\n      }\n    `,document.head.appendChild(e)}createWidgetElements(){const e=document.createElement("div");e.className="saas-chat-widget";const t=document.createElement("div");t.className="saas-chat-button",t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>',t.addEventListener("click",this.toggleChatWindow.bind(this));const n=document.createElement("div");n.className="saas-chat-window",n.id="saas-chat-window";const s=document.createElement("div");s.className="saas-chat-header",s.innerHTML=`\n      <div>${this.config.headerText}</div>\n      <div class="saas-chat-close">\n        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n          <line x1="18" y1="6" x2="6" y2="18"></line>\n          <line x1="6" y1="6" x2="18" y2="18"></line>\n        </svg>\n      </div>\n    `,s.querySelector(".saas-chat-close")?.addEventListener("click",this.closeChatWindow.bind(this));const i=document.createElement("div");i.className="saas-chat-messages",i.id="saas-chat-messages";const a=document.createElement("div");a.className="saas-chat-input-container";const o=document.createElement("textarea");o.className="saas-chat-input",o.placeholder=this.config.placeholder,o.rows=1,o.addEventListener("keydown",(e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),this.sendMessage()),setTimeout((()=>{o.style.height="auto",o.style.height=Math.min(o.scrollHeight,100)+"px"}),0)}));const r=document.createElement("button");r.className="saas-chat-send",r.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>',r.addEventListener("click",this.sendMessage.bind(this)),a.appendChild(o),a.appendChild(r),n.appendChild(s),n.appendChild(i),n.appendChild(a),e.appendChild(n),e.appendChild(t),document.body.appendChild(e),this.elements={widgetContainer:e,chatButton:t,chatWindow:n,messagesContainer:i,input:o,sendButton:r},this.config.welcomeMessage&&this.addMessage(this.config.welcomeMessage,"agent")}toggleChatWindow(){this.elements.chatWindow?.classList.contains("open")?this.closeChatWindow():this.openChatWindow()}openChatWindow(){this.elements.chatWindow?.classList.add("open"),this.elements.input?.focus(),this.initializeSocket()}closeChatWindow(){this.elements.chatWindow?.classList.remove("open")}addMessage(e,t){if(!this.elements.messagesContainer)return;const n=document.createElement("div");n.className=`saas-chat-message ${t}`,n.textContent=e,this.elements.messagesContainer.appendChild(n),this.elements.messagesContainer.scrollTop=this.elements.messagesContainer.scrollHeight}sendMessage(){if(!this.elements.input)return;const e=this.elements.input.value.trim();e&&(this.addMessage(e,"user"),this.elements.input.value="",this.elements.input.style.height="auto",this.socket&&this.socket.connected?(this.socket.emit("send-message",{chatId:this.currentChatId,content:e}),this.log("Message sent:",e)):(this.log("Socket not connected, storing message for later"),this.pendingMessages.push(e),this.initializeSocket()))}initializeSocket(){this.socket&&this.socket.connected?this.log("Socket already connected"):(this.log("Connecting to socket server:",this.config.socketUrl),this.config.userId||(this.config.userId=localStorage.getItem("saas-chat-user-id"),this.config.userId||(this.config.userId="widget_"+Math.random().toString(36).substring(2,15),localStorage.setItem("saas-chat-user-id",this.config.userId))),this.socket=e.io(this.config.socketUrl,{auth:{token:this.config.apiKey,userId:this.config.userId,userName:this.config.userName||"Website Visitor",userEmail:this.config.userEmail,organization:this.config.organization},transports:["websocket"]}),this.socket.on("connect",(()=>{this.log("Socket connected"),this.getOrCreateChat()})),this.socket.on("disconnect",(()=>{this.log("Socket disconnected")})),this.socket.on("error",(e=>{this.log("Socket error:",e)})),this.socket.on("new-message",(e=>{this.log("New message received:",e),e.message.sender._id!==this.config.userId&&this.addMessage(e.message.content,"agent")})))}getOrCreateChat(){this.log("Getting or creating chat"),this.currentChatId=localStorage.getItem("saas-chat-chat-id"),this.currentChatId?(this.log("Found existing chat:",this.currentChatId),this.socket&&this.socket.emit("join-chat",this.currentChatId),this.sendPendingMessages()):(this.log("Creating new chat"),fetch(`${this.config.apiUrl}/api/widget/chats`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.config.apiKey}`},body:JSON.stringify({userId:this.config.userId,userName:this.config.userName||"Website Visitor",userEmail:this.config.userEmail,organization:this.config.organization})}).then((e=>e.json())).then((e=>{this.log("Chat created:",e),e.success&&e.data&&e.data._id?(this.currentChatId=e.data._id,localStorage.setItem("saas-chat-chat-id",this.currentChatId),this.socket&&this.socket.emit("join-chat",this.currentChatId),this.sendPendingMessages()):this.log("Failed to create chat:",e)})).catch((e=>{this.log("Error creating chat:",e)})))}sendPendingMessages(){this.pendingMessages.length>0&&this.currentChatId&&this.socket&&(this.log("Sending pending messages:",this.pendingMessages),this.pendingMessages.forEach((e=>{this.socket?.emit("send-message",{chatId:this.currentChatId,content:e})})),this.pendingMessages=[])}log(){if(this.config.debug){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];console.log("SaaS Chat Widget:",...t)}}open(){this.openChatWindow()}close(){this.closeChatWindow()}destroy(){this.socket&&(this.socket.disconnect(),this.socket=null),this.elements.widgetContainer&&document.body.removeChild(this.elements.widgetContainer),this.elements={widgetContainer:null,chatButton:null,chatWindow:null,messagesContainer:null,input:null,sendButton:null}}}if("undefined"!=typeof window){const e=document.currentScript;if(e){const t={};Array.from(e.attributes).forEach((e=>{if(e.name.startsWith("data-")){const n=e.name.slice(5).replace(/-([a-z])/g,((e,t)=>t.toUpperCase()));"true"===e.value?t[n]=!0:"false"===e.value?t[n]=!1:t[n]=e.value}})),window.saasChat=new n(t)}}return n}));
//# sourceMappingURL=index.umd.js.map
